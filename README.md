# 🚨 CCTV 영상 기반 AI 군중 위험도 감지 시스템

YOLO 기반 실시간 사람 검출 및 혼잡도 분석 웹 서비스

## 📋 프로젝트 개요

이 프로젝트는 CCTV 영상을 분석하여 군중의 위험도를 실시간으로 감지하고, 안전한 방향을 추천하는 Streamlit 기반 웹 애플리케이션입니다.

### 주요 기능

- ✅ **YOLO 기반 사람 검출**: ultralytics YOLOv8n 모델을 사용한 실시간 사람 검출
- ✅ **그리드 기반 분석**: 화면을 3×3 그리드로 분할하여 구역별 인원 분석
- ✅ **혼잡도 지수(CDI) 계산**: 전체 인원수와 고밀집 구역을 기반으로 위험도 산출
- ✅ **4단계 위험도 표시**: GREEN(안전) → YELLOW(주의) → ORANGE(경고) → RED(위험)
- ✅ **안전 방향 안내**: 사람 수가 가장 적은 구역을 찾아 방향 추천
- ✅ **히트맵 시각화**: 구역별 인원 밀도를 히트맵으로 표시 (옵션)

## 📁 프로젝트 구조

```
project_root/
├── app.py                # Streamlit 메인 애플리케이션
├── crowd_detect.py       # YOLO 기반 사람 검출 모듈
├── density.py            # 혼잡도 지수(CDI) 계산 모듈
├── direction.py          # 안전 방향 계산 모듈
├── utils.py              # 그리드 생성, 히트맵 등 유틸리티 함수
├── create_sample_video.py # 테스트용 샘플 비디오 생성 스크립트
├── requirements.txt      # Python 패키지 의존성
├── README.md            # 프로젝트 설명서
└── assets/
    └── sample_video.mp4  # 샘플 영상 파일 (선택사항)
```

## 🚀 설치 및 실행 방법

### 1. 필수 요구사항

- Python 3.8 이상
- pip (Python 패키지 관리자)

### 2. 패키지 설치

```bash
pip install -r requirements.txt
```

### 3. 샘플 영상 준비 (선택사항)

**옵션 A: 테스트용 샘플 비디오 생성**
```bash
python create_sample_video.py
```
이 명령어를 실행하면 `assets/sample_video.mp4` 파일이 자동으로 생성됩니다.

**옵션 B: 직접 영상 파일 추가**
```bash
mkdir assets
# sample_video.mp4 파일을 assets/ 디렉토리에 복사
```

**옵션 C: 애플리케이션에서 업로드**
애플리케이션 실행 후 사이드바에서 "영상 업로드" 옵션을 선택하여 직접 업로드할 수 있습니다.

### 4. 애플리케이션 실행

```bash
streamlit run app.py
```

브라우저가 자동으로 열리며 `http://localhost:8501`에서 애플리케이션을 확인할 수 있습니다.

## 🎮 사용 방법

1. **영상 입력**
   - 사이드바에서 "기본 샘플 영상" 또는 "영상 업로드" 선택
   - MP4, AVI, MOV 형식 지원

2. **설정 조정**
   - 검출 신뢰도: YOLO 검출 임계값 조정 (0.1 ~ 0.9)
   - 히트맵 표시: 구역별 인원 밀도 시각화 옵션
   - 프레임 처리 속도: 실시간 처리 FPS 조정 (1 ~ 10)

3. **그리드 설정**
   - 기본적으로 3×3 그리드 사용

4. **분석 시작**
   - "처리 시작" 버튼: 실시간 프레임별 자동 분석
   - "현재 프레임 분석" 버튼: 특정 프레임만 분석
   - 프레임 슬라이더로 원하는 프레임으로 이동 가능

## 📊 출력 정보

### 위험도 표시
- **GREEN (0.0~0.3)**: 안전 - 군중이 적고 분산되어 있음
- **YELLOW (0.3~0.6)**: 주의 - 군중이 증가하기 시작
- **ORANGE (0.6~0.8)**: 경고 - 고밀집 구역 발생
- **RED (0.8~1.0)**: 위험 - 매우 높은 밀도, 대피 필요

### 안전 방향 안내
- 그리드 중 사람 수가 가장 적은 구역을 찾아 방향 추천
- 화살표(↑↓→←)와 텍스트로 표시

### 그리드별 인원 분포
- 각 구역별 검출된 인원 수를 테이블과 차트로 표시

## 🔧 기술 스택

- **Streamlit**: 웹 애플리케이션 프레임워크
- **YOLOv8**: 객체 검출 모델 (ultralytics)
- **OpenCV**: 영상 처리
- **NumPy**: 수치 계산
- **Pandas**: 데이터 분석 및 표시

## 📝 모듈 설명

### `crowd_detect.py`
- YOLO 모델을 사용한 사람 검출
- 검출 박스 그리기 및 인원 수 계산

### `density.py`
- 혼잡도 지수(CDI) 계산
- 위험도 레벨 판정 (GREEN/YELLOW/ORANGE/RED)

### `direction.py`
- 그리드별 인원 수 비교
- 가장 안전한 방향 계산 및 표시

### `utils.py`
- 그리드 생성 및 관리
- 히트맵 생성
- 그리드 위치 이름 변환

## ⚠️ 주의사항

- 첫 실행 시 YOLO 모델이 자동으로 다운로드됩니다 (약 6MB)
- GPU가 있으면 자동으로 사용되며, CPU만 있어도 동작합니다 (속도는 느림)
- 영상 파일이 클 경우 처리 속도가 느려질 수 있습니다
- 실시간 처리는 프레임 처리 속도 설정에 따라 조절됩니다

## 🔄 향후 개선 사항

- [ ] 실시간 웹캠 입력 지원
- [ ] 다중 영상 동시 분석
- [ ] 분석 결과 저장 및 리포트 생성
- [ ] 알림 시스템 (위험도 임계값 초과 시)
- [ ] 모바일 반응형 UI 개선

## 📄 라이선스

이 프로젝트는 교육 및 연구 목적으로 제공됩니다.

## 👤 문의

문제가 발생하거나 개선 사항이 있으면 이슈를 등록해주세요.

---

**Made with ❤️ using Streamlit & YOLO**

